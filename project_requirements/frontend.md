# Frontend Design: Research Report Viewer

This document outlines the frontend design and implementation details for the Web-Based Research Report Viewer (Task 11).

## 1. Overview

The report viewer provides an interactive HTML interface for users to read, filter, and search the research reports generated by the Blog Accelerator Agent. It is served by a FastAPI backend endpoint but relies heavily on client-side JavaScript for interactivity.

## 2. Technology Stack

*   **HTML:** Structure provided by a Jinja2 template (`templates/report_viewer.html`) rendered by the FastAPI backend.
*   **CSS:** Custom styling defined in `static/report_styles.css` for layout, typography, controls, and highlighting.
*   **JavaScript:** Core interactivity logic in `static/report_viewer.js` (vanilla JS) for filtering, searching, and potentially Markdown rendering.

## 3. HTML Structure (`templates/report_viewer.html`)

*   **Header:** Contains the main title (`<h1>`) and the `controls` div.
*   **Controls (`<div class="controls">`):**
    *   **Filters (`<div class="filters">`):** Contains buttons for each major research category (Audience, Solution, Industry, Paradigm, Visuals, Analogies, Citations) plus an "All" button. Each button has a `data-filter` attribute corresponding to the category name.
    *   **Search (`<div class="search">`):** Contains an `<input type="text">` with the ID `search-input`.
*   **Main Content (`<main id="report-content">`):**
    *   Conditionally renders content based on data passed from the backend (`report_markdown` or `research_data`).
    *   If `research_data` is used, the content is divided into `<section>` elements.
    *   Each `<section>` has a `data-category` attribute matching one of the filter button values (e.g., `data-category="audience"`).
    *   If `report_markdown` is used, it's initially placed in a hidden `<pre>` tag. A separate `div` is used as a target for potential client-side Markdown rendering (optional).
*   **Scripts:** Links to the `report_viewer.js` file at the end of the `<body>`.

## 4. CSS Styling (`static/report_styles.css`)

*   Provides basic page layout, typography, and color scheme.
*   Styles the header, controls (filter buttons, search bar), and main content area.
*   Defines styles for active filter buttons (`button.active`).
*   Defines styles for hidden sections (`section.hidden`).
*   Defines styles for search result highlighting (`span.highlight`).
*   Includes basic responsive design using media queries for smaller screens.

## 5. JavaScript Functionality (`static/report_viewer.js`)

*   **Initialization:** Runs when the DOM is fully loaded.
*   **Event Listeners:**
    *   Attaches `click` listeners to all filter buttons.
    *   Attaches an `input` listener to the search input field (with debouncing to limit rapid execution).
*   **Filtering Logic:**
    *   When a filter button is clicked:
        *   Updates the `activeFilter` variable.
        *   Updates the visual style of the buttons (adds/removes `active` class).
        *   Calls the main `applyFiltersAndSearch` function.
*   **Search Logic:**
    *   When the search input changes (after debouncing):
        *   Updates the `currentHighlightTerm` variable.
        *   Calls the main `applyFiltersAndSearch` function.
*   **Combined Filtering & Search (`applyFiltersAndSearch`):**
    *   Iterates through all `<section>` elements with `data-category`.
    *   Checks if the section matches the `activeFilter` OR if the filter is "all".
    *   Checks if the section's text content includes the `currentHighlightTerm` (case-insensitive) OR if the search term is empty.
    *   Shows the section if it matches BOTH the category filter and the search term.
    *   Hides the section otherwise.
    *   Calls highlighting functions based on visibility and search term presence.
*   **Text Highlighting:**
    *   Uses `TreeWalker` to efficiently find text nodes within a visible section.
    *   Wraps matching search terms (case-insensitive) in `<span class="highlight">`.
    *   Includes logic to remove previous highlights before applying new ones.
    *   Handles regex special characters in the search term.
*   **(Optional) Markdown Rendering:** Includes commented-out code suggesting how to integrate a library like Marked.js to render Markdown content if `report_markdown` is provided by the backend.

## 6. Data Flow (Frontend)

1.  User accesses `/reports/view/{blog_title}/{version}`.
2.  FastAPI retrieves data from MongoDB.
3.  FastAPI renders `report_viewer.html` using Jinja2, passing the data.
4.  Browser loads HTML, CSS, and JS.
5.  `report_viewer.js` initializes, sets up event listeners.
6.  User clicks a filter button or types in the search bar.
7.  The corresponding event listener triggers `applyFiltersAndSearch`.
8.  JavaScript manipulates the DOM to show/hide sections and apply/remove highlighting based on the current filter and search term.

## 7. Future Enhancements (Optional)

*   Implement client-side Markdown rendering using a library.
*   Improve the rendering of structured `research_data` for better readability.
*   Add more sophisticated search options (e.g., whole word matching).
*   Persist filter/search state (e.g., using URL parameters or local storage). 